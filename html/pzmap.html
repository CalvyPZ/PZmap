<!DOCTYPE html>
<html>
  <head>
    <title id="page_title"></title>
    <script type="text/javascript" src="openseadragon/openseadragon.js"></script>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <link rel="stylesheet" href="pzmap.css">
  </head>
  <body>
    <div class="page-row">
      <!-- Sidebar Container -->
      <div id="sidebar-container">
        <!-- Sidebar -->
        <div id="sidebar">
          <div class="sidebar-header">B42 Map</div>
          
          <!-- View Toggle -->
          <div id="top_view_link">
            <a id="change_view_btn" onclick="onChangeView()">Loading...</a>
          </div>
          <div class="divider"></div>

          <!-- Layer Controls -->
          <div id="sidebar-controls">
        <select id="layer_selector" onchange="onLayerSelect()"></select>
            <label for="roof_opacity_slider" class="slider-label">Roof Layer Opacity: 0%</label>
            <input id="roof_opacity_slider" type="range" min="0" max="100" value="0" step="10"
                   class="iso-only-btn modern-slider" oninput="updateRoofOpacity()" title="Roof Layer Opacity">
            <div id="mouse-coordinates" style="text-align: center; font-size: 14px; color: lightgray;">
              X: 0, Y: 0
        </div>
          </div>
          <div class="divider"></div>

          <!-- Main Buttons -->
          <ul class="sidebar-list">
            
            <li><button id="pois_btn" onclick="togglePOIs()">POIs</button></li>
            <li><button id="lock_coords_btn" onclick="toggleCoordinatesLock()">Lock Coordinates</button></li>
            <!-- <li><button id="zombie_btn" onclick="toggleOverlay('zombie')">Zombie</button></li> -->
            <li><button id="streets_btn" onclick="toggleOverlay('streets')">Streets</button></li>
            <li><button id="foraging_btn" onclick="toggleOverlay('foraging')">Foraging</button></li>
            <li><button id="rooms_btn" onclick="toggleOverlay('rooms')">Rooms</button></li>
            <li><button id="objects_btn" onclick="toggleOverlay('objects')">Objects</button></li>
            <li><button id="grid_btn" onclick="toggleGrid()">Grid</button></li>
            <li><button id="help_wiki_btn" onclick="window.open('https://pzwiki.net/wiki/PZwiki:Project_Build_42_Update', '_blank')">Help the wiki!</button></li>
          </ul>

          <!-- Help Section -->
          <div class="divider"></div>
          <ul class="sidebar-list">
            <li><button id="help_btn" onclick="showHelpPopup()">Map Help</button></li>
          </ul>

          <!-- Legend Section -->
          <div id="sidebar-overlays">
          <div id="legends">
              <div id="foraging_ui" class="legend-container"></div>
              <div class="legend-separator"></div>
              <div id="objects_ui" class="legend-container"></div>
            </div>
          </div>

          <!-- Footer Section -->
          <div class="divider"></div>
          <div id="footer_text">
            <strong>VIEWER 2.0<br></strong><br>
            <strong>Created with:</strong><br>
            <a href="https://github.com/cff29546/pzmap2dzi" target="_blank">PZmap2dzi</a><br><br>
            <strong>Map engine:</strong><br>
            <a href="https://github.com/openseadragon/openseadragon/" target="_blank">OpenSeaDragon</a><br><br>
            <strong>Created by:</strong><br>
            <a href="https://pzwiki.net/wiki/Project_Zomboid_Wiki" target="_blank">PZwiki Volunteers</a>
            <br><p>Last updated:<br>Build 42.11.0</p>
          </div>
        </div>
      </div>
      
      <!-- Main Content -->
      <div class="map-container">
        <!-- Hamburger button -->
        <button id="sidebarToggle" onclick="toggleSidebar()">☰</button>
        <div id="map_div" allowfullscreen style="height: 100%"></div>
        <svg id="svg_overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;" xmlns="http://www.w3.org/2000/svg">
          <defs id="svg_defs"></defs>
          <g id="svg_iso" transform="matrix(0.5, 0.25, -0.5, 0.25, 0, 0)"></g>
          <g id="svg_top"></g>
        </svg>
      </div>
    </div>
    
    <!-- Search Container -->
    <div id="search-container">
      <div class="search-box-wrapper">
        <input id="search-input" type="text" placeholder="Search POIs, Streets, Objects, Rooms, Tiles">
        <button id="clear-search-btn">X</button>
      </div>
      <div id="search-results" class="hidden"></div>
    </div>
    
    <!-- Help Popup -->
    <div id="help-popup-overlay" class="popup-overlay" onclick="hideHelpPopup()">
      <div id="help-popup" class="help-popup" onclick="event.stopPropagation()">
        <div class="help-popup-header">
          <h2>B42 Map Help</h2>
          <button class="help-close-btn" onclick="hideHelpPopup()">×</button>
        </div>
        <div class="help-popup-content">
          <h3>Menu Buttons</h3>
          <p>• <strong>POIs:</strong> Toggle visibility of markers</p>
          <p>• <strong>Streets:</strong> Toggle visibility of the streets overlay</p>
          <p>• <strong>Foraging:</strong> Toggle visibility of foraging biomes</p>
          <p>• <strong>Rooms:</strong> Toggle visibility of room definitions</p>
          <p>• <strong>Objects:</strong> Toggle visibility of zombie spawn, vehicle spawn, and zone stories</p>
          <p>• <strong>Grid:</strong> Toggle visibility of the coordinate grid</p>
          
          <h3>Search</h3>
          <p>• Search box to find POIs, streets, objects, rooms, and tiles</p>
          <p>• Only specific tiles can be searched for.</p>
          <p>• Click on a search result to navigate to it's location</p>
          <p>• Use "Show All Results" to display multiple markers</p>
          
          <h3>Coordinates</h3>
          <p>• Click "Lock Coordinates" then click on the map. The coordinates will be copied to your clipboard.</p>
        </div>
      </div>
    </div>
    
    <script type="text/javascript" src="pzmap.js"></script>
  </body>
</html>
